<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>USA Treemap</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: sans-serif; }
    .node rect {
      stroke: #fff;
    }
    .label {
      pointer-events: none;
      font-size: 12px;
      fill: white;
      text-shadow: 1px 1px 2px black;
    }
    .state-label {
      font-size: 16px;
      font-weight: bold;
      fill: black;
    }
  </style>
</head>
<body>

<svg width="10000" height="10000"></svg>

<script>
d3.json("https://raw.githubusercontent.com/tekkyboy/DSCI-550_Haunted-Places-of-America/main/DSCI-550_Visualizations_JSON/treemap_data_sorted.json")
  .then(function(data) {
    const width = 10000, height = 10000;
    const svg = d3.select("svg");

    const color = d3.scaleOrdinal(d3.schemeCategory10);

    const root = d3.hierarchy(data)
    .eachAfter(d => {
      // If it's a city (leaf), store its own value
      if (!d.children) {
        d.data._originalValue = d.data.value || 0;
      } else {
        // If it's a state, sum the values of its children
        d.data._totalValue = d.children.reduce((sum, child) => sum + (child.data._originalValue || 0), 0);
      }
    })
    .count();  // Uniform sizes for cities


  d3.treemap()
    .size([width, height])
    .paddingInner(0.5)    // â†“ smaller gap between cities
    .paddingOuter(1)      // slight gap around entire block
    .paddingTop(d => d.depth === 1 ? 16 : 0) // space for state labels only
    (root);


    const node = svg.selectAll("g")
      .data(root.descendants())
      .join("g")
      .attr("transform", d => `translate(${d.x0},${d.y0})`);

    node.append("rect")
      .attr("width", d => (d.x1 - d.x0) * 0.7)
      .attr("height", d => d.y1 - d.y0)
      .attr("fill", d => {
        if (d.depth === 1) return color(d.data.name);
        if (d.parent) return color(d.parent.data.name);
        return "#ccc";
      });

  // City Labels (uniform size, but show actual value)
  node.filter(d => !d.children).append("text")
    .attr("class", "label")
    .attr("x", 4)
    .attr("y", 14)
    .attr("font-size", d => {
    const boxWidth = d.x1 - d.x0;
    const boxHeight = d.y1 - d.y0;
    const nameLength = d.data.name.length + 5; // name + value extra characters
    // Font size shrinks if box is too narrow
    return Math.min((boxWidth / nameLength) * 1.5, boxHeight * 0.6, 12); // 12px max
    })
    .text(d => `${d.data.name} (${d.data._originalValue})`);

    
  // State Labels with Total Value
  node.filter(d => d.depth === 1).append("text")
    .attr("class", "state-label")
    .attr("x", 4)
    .attr("y", 16)
    .text(d => `${d.data.name} (${d.data._totalValue})`);

  });
</script>
</body>
</html>
