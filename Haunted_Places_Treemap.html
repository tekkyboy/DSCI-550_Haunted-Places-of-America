<!DOCTYPE html>
<html>
<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <h3>Treemap: Cities within States</h3>
  <svg style="border:1px solid black;"></svg>

  <script>
    // Fetch the JSON data from the GitHub repository
    fetch('https://raw.githubusercontent.com/tekkyboy/DSCI-550_Haunted-Places-of-America/main/DSCI-550_Visualizations_JSON/hierarchy_data.json')
      .then(response => response.json())
      .then(imported_js_data => {
        const svg = d3.select("svg");
        const width = 13000, height = 13000;
        const margin = { top: 20, right: 30, bottom: 40, left: 90 };

        // Define a color scale based on the unique states
        const colorScale = d3.scaleOrdinal(d3.schemeCategory10)
          .domain(imported_js_data.children.map(d => d.name));

        const root = d3.hierarchy(imported_js_data)
          .sum(d => d.value);  // Use the value field to size the rectangles

        const treemapLayout = d3.treemap()
          .size([width, height])
          .padding(2);

        treemapLayout(root);  // Apply the treemap layout to the hierarchy data

        svg.attr("width", width).attr("height", height);

        // Create rectangles for each state
        svg.selectAll("rect.state")
          .data(root.children)
          .enter()
          .append("rect")
          .attr("class", "state")
          .attr("x", d => d.x0)
          .attr("y", d => d.y0)
          .attr("width", d => d.x1 - d.x0)
          .attr("height", d => d.y1 - d.y0)
          .attr("fill", d => colorScale(d.data.name));

        // Create rectangles for each city within the state
        svg.selectAll("rect.city")
          .data(root.leaves())
          .enter()
          .append("rect")
          .attr("class", "city")
          .attr("x", d => d.x0)
          .attr("y", d => d.y0)
          .attr("width", d => d.x1 - d.x0)
          .attr("height", d => d.y1 - d.y0)
          .attr("fill", d => colorScale(d.parent.data.name));

        // Add text labels for each city
        svg.selectAll("text.city")
          .data(root.leaves())
          .enter()
          .append("text")
          .attr("class", "city")
          .attr("x", d => (d.x0 + d.x1) / 2)
          .attr("y", d => (d.y0 + d.y1) / 2)
          .attr("alignment-baseline", "middle")
          .attr("text-anchor", "middle")
          .text(d => d.data.name);
      });
  </script>
</body>
</html>
