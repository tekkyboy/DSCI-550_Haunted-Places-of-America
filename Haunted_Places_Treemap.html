<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zoomable Treemap</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
    }
    svg {
      border: 1px solid black;
    }
  </style>
</head>
<body>

<h3>Interactive Treemap: Cities in States</h3>
<svg width="960" height="600"></svg>

<script>
  const width = 960;
  const height = 600;

  // Example of hierarchical data
  const data = {
    "name": "USA",
    "children": [
      {
        "name": "California",
        "children": [
          { "name": "Los Angeles", "value": 100 },
          { "name": "San Francisco", "value": 50 }
        ]
      },
      {
        "name": "New York",
        "children": [
          { "name": "New York City", "value": 80 },
          { "name": "Buffalo", "value": 40 }
        ]
      }
    ]
  };

  const svg = d3.select("svg"),
        margin = {top: 20, right: 30, bottom: 40, left: 90},
        width = svg.attr("width") - margin.left - margin.right,
        height = svg.attr("height") - margin.top - margin.bottom;

  const treemap = d3.treemap().size([width, height]).padding(1);
  let root;

  // Create a root node from the hierarchical data
  root = d3.hierarchy(data).sum(d => d.value);
  treemap(root);

  // Create a zoom function
  const zoom = d3.zoom().on("zoom", (event) => {
    svg.attr("transform", event.transform);
  });

  svg.call(zoom);

  // Create the rectangles for the treemap
  const cells = svg.selectAll("g")
    .data(root.leaves())
    .enter().append("g")
    .attr("transform", d => `translate(${d.x0},${d.y0})`);

  cells.append("rect")
    .attr("width", d => d.x1 - d.x0)
    .attr("height", d => d.y1 - d.y0)
    .style("fill", "steelblue")
    .style("stroke", "white");

  cells.append("text")
    .attr("x", 5)
    .attr("y", 15)
    .text(d => d.data.name)
    .style("fill", "white");

  // Add zoom functionality for state-level interaction
  svg.on("click", function(event) {
    const coords = d3.pointer(event);
    const clickedNode = root.descendants().find(d => 
      coords[0] >= d.x0 && coords[0] <= d.x1 && coords[1] >= d.y0 && coords[1] <= d.y1
    );

    if (clickedNode && clickedNode.depth === 1) { // Check if it's a state node
      root = clickedNode;
      treemap(root);
      updateTreemap();
    }
  });

  // Function to update the treemap
  function updateTreemap() {
    const cells = svg.selectAll("g")
      .data(root.leaves(), d => d.data.name)
      .join("g")
      .attr("transform", d => `translate(${d.x0},${d.y0})`);

    cells.append("rect")
      .attr("width", d => d.x1 - d.x0)
      .attr("height", d => d.y1 - d.y0)
      .style("fill", "steelblue")
      .style("stroke", "white");

    cells.append("text")
      .attr("x", 5)
      .attr("y", 15)
      .text(d => d.data.name)
      .style("fill", "white");
  }

</script>
</body>
</html>
