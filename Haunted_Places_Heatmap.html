<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Haunted Sightings vs Sun-Up Duration Heatmap</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <style>
    body { font-family: sans-serif; }
    .cell { stroke: #fff; }
    .axis text { font-size: 12px; }
  </style>
</head>
<body>

<h3>Haunted Sightings vs. Sunlight Duration</h3>
<svg width="900" height="600"></svg>

<script>
  d3.json("DSCI-550_Visualizations_JSON/heatmap_data.json").then(function(data) {

    const margin = {top:40, right:20, bottom:120, left:140},
          width  = 900 - margin.left - margin.right,
          height = 600 - margin.top  - margin.bottom;

    const svg = d3.select("svg")
                  .attr("width", width + margin.left + margin.right)
                  .attr("height", height + margin.top + margin.bottom)
                  .append("g")
                  .attr("transform", `translate(${margin.left},${margin.top})`);

    const xVals = [...new Set(data.map(d => d["Time of Day"]))];
    const yVals = [...new Set(data.map(d => d["Sunlight Bin"]))];

    const x = d3.scaleBand().domain(xVals).range([0, width]).padding(0.05);
    const y = d3.scaleBand().domain(yVals).range([0, height]).padding(0.05);

    const max = d3.max(data, d => d.Count);
    const color = d3.scaleSequential(d3.interpolateOrRd).domain([0, max]);

    svg.append("g").call(d3.axisLeft(y));

    svg.append("g")
       .attr("transform", `translate(0,${height})`)
       .call(d3.axisBottom(x))
       .selectAll("text")
       .attr("transform", "rotate(-40)")
       .style("text-anchor", "end");

    svg.selectAll("rect")
       .data(data)
       .enter().append("rect")
         .attr("x", d => x(d["Time of Day"]))
         .attr("y", d => y(d["Sunlight Bin"]))
         .attr("width", x.bandwidth())
         .attr("height", y.bandwidth())
         .attr("fill", d => color(d.Count))
         .attr("class", "cell")
       .append("title")
         .text(d => `${d.Count} sighting${d.Count === 1 ? "" : "s"}`);

    // Legend
    const legendW = 200, legendH = 10;
    const legend = svg.append("g")
                      .attr("transform", `translate(0,${height+50})`);

    const lScale = d3.scaleLinear().domain([0, max]).range([0, legendW]);
    const lAxis = d3.axisBottom(lScale).ticks(5).tickFormat(d3.format("d"));

    const defs = svg.append("defs");
    const grad = defs.append("linearGradient").attr("id", "legendGradient");
    grad.selectAll("stop")
        .data(d3.ticks(0, max, 10))
        .enter().append("stop")
          .attr("offset", d => `${(d / max) * 100}%`)
          .attr("stop-color", d => color(d));

    legend.append("rect")
          .attr("width", legendW)
          .attr("height", legendH)
          .style("fill", "url(#legendGradient)");

    legend.append("g")
          .attr("transform", `translate(0,${legendH})`)
          .call(lAxis);

  });
</script>

</body>
</html>
